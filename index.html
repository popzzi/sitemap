<!doctype html>
<html>
<head>
  <!-- ❌ base 제거 (GitHub Pages에서는 불필요) -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>사이트맵</title>

  <!-- ===== CSS (원본 그대로) ===== -->
  <style>
    :root{
      --text:#e8eefc;
      --muted:#a7b4d6;
      --line:rgba(255,255,255,.08);
      --accent:#7aa2ff;
      --accent2:#52d6a8;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background: linear-gradient(180deg, #070b14, #0b1220 40%, #07101f);
      color:var(--text);
    }
    .app{display:flex;height:100vh;width:100%;overflow:hidden;}
    aside{
      width:320px;min-width:280px;
      background: rgba(15,26,48,.85);
      border-right:1px solid var(--line);
      padding:18px;overflow:auto;
      backdrop-filter: blur(10px);
    }
    main{flex:1;padding:18px;overflow:auto;}
    .brand{display:flex;align-items:center;gap:4px;padding:5px;}
    .logo{
      width:37px;height:37px;
      background-image:url(https://img.icons8.com/?size=100&id=SQ7k596FkHLa&format=png&color=000000);
      background-size:cover;
    }
    .brand h1{font-size:16px;margin:0}
    .brand p{margin:2px 0 0;font-size:12px;color:var(--muted)}
    .search{margin:8px 0 14px;position:sticky;top:0;background:rgba(15,26,48,.92);padding-bottom:10px;z-index:5;}
    .search input{
      width:100%;padding:12px;
      border-radius:14px;border:1px solid var(--line);
      background:rgba(0,0,0,.18);color:var(--text);
    }
    .search input::placeholder{color:rgba(231,237,255,.45)}
    .section-title{font-size:12px;color:var(--muted);margin:14px 6px 8px;text-transform:uppercase;letter-spacing:.06em;}
    .cat-list{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;}
    .cat-btn{display:flex;justify-content:space-between;padding:10px 12px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.03);cursor:pointer;}
    .cat-btn.active{outline:2px solid rgba(122,162,255,.45);background:rgba(122,162,255,.10);}
    .pill{font-size:12px;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px;}
    .topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px;}
    .chip{padding:8px 10px;border-radius:999px;border:1px solid var(--line);cursor:pointer;}
    .chip.active{background:rgba(82,214,168,.12);outline:2px solid rgba(82,214,168,.35);}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(220px,1fr));gap:12px;}
    @media(max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:780px){aside{display:none}.grid{grid-template-columns:1fr}}
    .card{border:1px solid var(--line);border-radius:var(--radius);background:rgba(17,31,58,.65);padding:14px;display:flex;flex-direction:column;gap:10px;}
    .row{display:flex;justify-content:space-between;gap:10px;}
    .title{display:flex;gap:10px;font-weight:700;font-size:14px;}
    .icon{width:35px;height:35px;border-radius:10px;display:grid;place-items:center;background:rgba(122,162,255,.12);}
    .icon img{width:25px;height:25px}
    .desc{font-size:12px;color:rgba(231,237,255,.75)}
    .btn{border:1px solid var(--line);background:rgba(0,0,0,.14);padding:8px 10px;border-radius:12px;min-width:64px;white-space:nowrap;}
    .star{width:34px;height:34px;border-radius:12px;border:1px solid var(--line);display:grid;place-items:center;cursor:pointer;}
    .star.on{background:rgba(255,214,102,.14)}
    .muted{color:var(--muted);font-size:12px}
    .url-text{flex:1 1 auto;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
  </style>
</head>

<body>
<div class="app">
  <aside>
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>사이트맵</h1>
          <p class="muted">스프레드시트 연동 링크 허브</p>
        </div>
      </div>

      <div class="search">
        <input id="q" placeholder="검색: 서비스명, 설명, 태그…" />
      </div>

      <div class="section-title">카테고리</div>
      <div id="cats" class="cat-list"></div>

      <div class="section-title">필터</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; padding:0 2px 10px;">
        <div id="chipAll" class="chip active">전체</div>
        <div id="chipFav" class="chip">즐겨찾기</div>
        <div id="chipRecent" class="chip">최근</div>
      </div>

      <div class="muted" style="padding: 6px 6px 14px; line-height:1.5;">
        • 링크 추가/수정은 관리자 계정의 구글 스프레드시트 Links 시트에서 일괄 관리됩니다.<br/>
        • 즐겨찾기/최근은 개인별로 저장돼요.<br/><br/>
        @ 2025 Hzzin. all rights reserved.
      </div>
    </aside>

    <main>
      <div class="topbar">
        <div class="left">
          <div id="current" class="muted">로딩 중…</div>
          <div id="count" class="pill">0</div>
        </div>
        <div class="actions">
          <button class="btn" id="refresh" type="button">새로고침</button>
        </div>
      </div>

      <div id="content" class="loading">데이터를 불러오는 중…</div>
    </main>
</div>

<script>
/* ===== 설정 ===== */
const API = "https://script.google.com/macros/s/AKfycbxvID6a8BAAeqj0HJ1bw1D87xZCYDQqOVXStubkQLCfz-l3i7ok6YrGPIL-cutJLHo05A/exec";

/* ===== state ===== */
var DATA = { categories: [], items: [] };
var USER = JSON.parse(localStorage.getItem('USER') || '{"favorites":[],"recents":[]}');
var selectedCategory = 'ALL';
var mode = 'ALL';
var query = '';

/* ===== init ===== */
document.addEventListener('DOMContentLoaded', function () {

  // ===== init =====
  document.getElementById('q').addEventListener('input', function (e) {
    query = (e.target.value || '').trim();
    render();
  });

  document.getElementById('refresh').addEventListener('click', function () {
    boot(false);
  });

  var chipAll = document.getElementById('chipAll');
  var chipFav = document.getElementById('chipFav');
  var chipRecent = document.getElementById('chipRecent');

  chipAll.onclick = function(){ mode='ALL'; setChip(); render(); };
  chipFav.onclick = function(){ mode='FAV'; setChip(); render(); };
  chipRecent.onclick = function(){ mode='RECENT'; setChip(); render(); };

  // 초기 로드
  boot(false);

});

/* ===== fetch 기반 boot ===== */
async function boot(){
  const content = document.getElementById('content');
  content.className='loading';
  content.textContent='데이터를 불러오는 중…';

  try{
    const res = await fetch(API+'?action=links');
    DATA = await res.json();
    buildCategories();
    render();
  }catch(e){
    content.className='empty';
    content.textContent='데이터 로드 실패';
  }
}

/* ===== USER (localStorage) ===== */
function persistUser(){ localStorage.setItem('USER',JSON.stringify(USER)); }

/* ===== 나머지 로직은 기존 render / cardHtml 그대로 사용 ===== */
</script>
</body>
</html>
